<p-card header="Demo Entry Form">
  <form [formGroup]="form" (ngSubmit)="submit()">

    <!-- Demo Info -->
    <div class="row mb-3">
      <div class="col-md-3">
        <label>Name</label><br>
        <input pInputText formControlName="name" />
      </div>
      <div class="col-md-3">
        <label>Create Date</label><br>
        <p-datepicker formControlName="createDate" dateFormat="yy-mm-dd" [showIcon]="true"></p-datepicker>
      </div>
      <div class="col-md-3 flex align-items-center gap-2">
        <label for="isActive">Is Active</label><br>
        <p-checkbox formControlName="isActive" inputId="isActive"></p-checkbox>   
      </div>
    </div>

    <p-divider></p-divider>

    <!-- Items -->
    <ng-container formArrayName="demoItems">
      <div *ngFor="let item of demoItems.controls; let i = index" [formGroupName]="i" class="mb-3 p-3 border-1 surface-border rounded">

        <div class="row">
          <div class="col-md-3">
            <label>Name</label><br>
            <input pInputText formControlName="name" />
          </div>
          <div class="col-md-3">
            <label>Title</label><br>
            <input pInputText formControlName="title" />
          </div>
          <div class="col-md-3">
            <label>Description</label><br>
            <textarea pInputTextarea formControlName="description"></textarea>
          </div>
          <div class="col-md-3 flex align-items-center gap-2">            
            <label for="isActiveItem{{i}}">Active</label><br>
            <p-checkbox formControlName="isActive" [inputId]="'isActiveItem' + i"></p-checkbox>
          </div>
        </div>

        <!-- Attachments Table -->
        <ng-container formArrayName="demoItemFileAttachments">
            @if(attachmentsAt(i).length > 0){
          <p-table  [value]="attachmentsAt(i).controls" size="small" [tableStyle]="{'min-width':'40rem'}">
            <ng-template pTemplate="header">
              <tr>
                <th>File Name</th>
                <th>Active</th>
                <th>Action</th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-att let-j="rowIndex">
              <tr [formGroupName]="j">
                <td>
                    <p-fileupload #fu mode="basic" chooseLabel="Choose" chooseIcon="pi pi-upload" name="demo[]" url="https://www.primefaces.org/cdn/api/upload.php" accept="image/*" maxFileSize="1000000" (onUpload)="onUpload($event)" />
                </td>
                <td><p-checkbox formControlName="isActive" [inputId]="'attActive' + i + '-' + j"></p-checkbox></td>
                <td>
                  <button type="button" pButton icon="pi pi-times" severity="danger" (click)="removeAttachment(i,j)"><i class="bi bi-trash"></i></button>
                </td>
              </tr>
            </ng-template>
          </p-table>
        }
          <button type="button" pButton icon="pi pi-plus" label="Add Attachment" (click)="addAttachment(i)" class="mt-2"></button>
        </ng-container>

        <button type="button" pButton icon="pi pi-trash" severity="danger" (click)="removeItem(i)" class="mt-2"><i class="bi bi-trash"></i></button>

      </div>
    </ng-container>

    <button type="button" pButton icon="pi pi-plus" label="Add Item" (click)="addItem()"></button>

    <p-divider></p-divider>

    <div class="flex justify-content-end gap-2 mt-2">
      <button type="button" pButton label="Reset" class="p-button-secondary" (click)="resetForm()"></button>
      <button type="submit" pButton label="Save" icon="pi pi-check"></button>
    </div>

  </form>
</p-card>
